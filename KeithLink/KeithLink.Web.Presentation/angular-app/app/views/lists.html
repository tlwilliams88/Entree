<div page-header-bar>
  <div header-message>
    <div ng-hide="displayEditingListName">
      <span>{{selectedList.name}}</span>
      <div style="display:inline-block;" ng-show="selectedList" ng-if="!selectedList.isFavoritesList">
        <a ng-click="startEditListName(selectedList.name)"><span class="hidden-print large-icon text-light icon-pencil"</span></a>
        <a confirmed-click="deleteList(selectedList.listid)" ng-confirm-click="This will delete the list {{selectedList.name}} and all items within. Are you sure you want to delete this list?"><span class="large-icon text-light icon-trash"></span></a>
      </div>
    </div>

    <form name="renameListForm" class="inline-header-form" ng-show="displayEditingListName">
      <input type="text" ng-required ng-minlength="3" ng-model="editList.name" />
      <button ng-disabled="renameListForm.$invalid" class="btn-no-style" type="submit" ng-click="renameList(selectedList.listid, editList.name)"><span class="large-icon text-green icon-checkmark"></span></button>
      <a ng-click="cancelEditListName()"><span class="large-icon text-red icon-cross"></span></a>
    </form>
  </div>
  <div header-buttons>
    <button class="btn btn-icon" ng-click="print()"><span class="icon-printer"></span></button>
    <button class="btn btn-icon"><span class="icon-disk"></span></button>
  </div>
</div>

<div class="row">
  <!-- Available Lists -->
  <div class="col-sm-2 hidden-xs hidden-sm hidden-print search-results__filters">
    <div class="row">
      <div class="col-sm-12 custom-lists">
        <h3>Your Lists</h3>

        <div class="btn-group-vertical list-names text-blue">
          <button ng-repeat="list in lists | orderBy:['isFavoritesList','name'] | limitTo: itemsLimit()" ng-click="goToList(list)" ng-class="{'current-list' : list.listid == selectedList.listid}" class="custom-lists__name btn btn-list" data-drop="true" data-jqyoui-options="{hoverClass:'bek-drag-hover',tolerance:'pointer',activeClass:'bek-drag-active'}" jqyoui-droppable="{onDrop: 'addItemToList(list.listid)'}">{{list.name}}</button>
        </div>
        <p class="custom-lists__more">
          <a ng-show="hasMoreItemsToShow()" ng-click="showMore()">Show More...</a>
          <a href=""></a>
        </p>
        
        <button ng-click="createList()" data-drop="true" data-jqyoui-options="{hoverClass:'bek-drag-hover',tolerance:'pointer',activeClass:'bek-drag-active'}" jqyoui-droppable="{onDrop: 'createListWithItem()'}" class="btn btn-list text-light">Create A List</button>
        
        <button class="btn btn-icon large-icon btn-trash" ng-disabled="!isDragging" data-drop="true" data-jqyoui-options="{hoverClass:'bek-drag-hover',tolerance:'pointer',activeClass:'bek-drag-active'}" jqyoui-droppable="{onDrop: 'deleteItemFromDrag(selectedList)'}"><span class="icon-trash"></span></button>

      </div>
    </div>
  </div>

  <!-- Items in List -->
  <div class="col-md-10 col-xs-12">
    
    <div>
      <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</alert>
    </div>
    
    <div style="margin-bottom:15px;">
      <input ng-model="listSearchTerm" type="text" class="form-control" placeholder="Search by keyword, item # or label">
    </div>
  
    <div class="text-right">
    Showing {{filteredItems.length}} of {{selectedList.items.length}} Results
    </div>

    <table class="table table-striped custom-lists__table sub-content">
      <thead>
        <tr>
          <th></th>
          <th style="cursor:pointer;" ng-click="sortOrder=!sortOrder; sortBy='itemnumber';">
            Item #
             <span ng-class="{
              'icon-menu':sortBy !== 'itemnumber',
              'icon-arrow-down4':sortBy == 'itemnumber' && !sortOrder,
              'icon-arrow-up3': sortBy == 'itemnumber' && sortOrder
            }"></span>
          </th>
          <th class="hidden-sm hidden-xs">
            Pack / Size
          </th>
          <th ng-click="sortOrder=!sortOrder;sortBy='name';">
            Name
            <span ng-class="{
              'icon-menu':sortBy !== 'name',
              'icon-arrow-down4':sortBy == 'name' && !sortOrder,
              'icon-arrow-up3': sortBy == 'name' && sortOrder
            }"></span>
          </th>
          <th ng-click="sortOrder=!sortOrder;sortBy='label';" ng-show="!selectedList.isFavoritesList">
            Label
            <span ng-class="{
              'icon-menu':sortBy !== 'label',
              'icon-arrow-down4':sortBy == 'label' && !sortOrder,
              'icon-arrow-up3': sortBy == 'label' && sortOrder
            }"></span>
          </th>
          <th ng-click="sortOrder=!sortOrder;sortBy='parlevel';" ng-show="!selectedList.isFavoritesList">
            PAR Level
            <span ng-class="{
              'icon-menu':sortBy !== 'parlevel',
              'icon-arrow-down4':sortBy == 'parlevel' && !sortOrder,
              'icon-arrow-up3': sortBy == 'parlevel' && sortOrder
            }"></span>
          </th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr style="cursor:move;" ng-class="{ odd : $odd, even: $even }" ng-repeat-start="item in (filteredItems = (selectedList.items | filter:search | orderBy:sortBy:sortOrder)) track by item.listitemid" data-product="{{item}}" data-drag="true" data-jqyoui-options="{helper:'clone', cursorAt: { top: -5, left: -5 }}" jqyoui-draggable="{onStart: 'setIsDragging(true)', onStop: 'setIsDragging(false)'}" class="table-striped__desktop-details">
          <td class="text-light table-icon hidden-drag">
            <span class="icon-list2" style="cursor:move;"></span>
            <span favorite-item-click-handlers><span favorite-icons></span></span>
          </td>
          <td>
            <a ui-sref="menu.catalog.products.details({ itemNumber : item.itemnumber, item: item })">{{item.itemnumber}}</a>
          </td>
          <td class="hidden-sm hidden-xs">
            {{item.packsize}}
          </td>
          <td>
            {{item.name}}
          </td>
          <td class="table-input hidden-drag" ng-if="!selectedList.isFavoritesList">
            
            <div ng-hide="item.isEditing">
              <div class="select-div hidden-print">
                <select ng-change="updateLabel(selectedList.listid, item)" name="" id="" ng-model="item.label" ng-options="label for label in labels">
                  <option value="">Select A Label...</option>
                </select>
              </div>
              <a ng-click="item.isEditing = true" class="large-icon hidden-print inline-icon"><span class="icon-plus3"></span></a>
            </div>

            <form class="hidden-print" name="addLabelForm" ng-show="item.isEditing">
              <input type="text" placeholder="New Label..." ng-required ng-minlength="3" ng-model="newLabel" />
              <button ng-disabled="addLabelForm.$invalid" class="btn-no-style" type="submit" ng-click="addNewLabel(selectedList.listid, newLabel, item)"><span class="large-icon text-green icon-checkmark"></span></button>
              <a ng-click="item.isEditing = false; newLabel = '';"><span class="large-icon text-red icon-cross"></span></a>
            </form>
            
            <span class="visible-print">{{item.label}}</span>
          </td>
          <td class="table-input hidden-drag" ng-if="!selectedList.isFavoritesList">
            <form class="hidden-print" name="editParForm">
              <input type="text" placeholder="" min-length="3" allow-one-positive-decimal="item.parlevel" ng-model="item.parlevel" style="width:50px;text-align:right;" />
              <button ng-disabled="editParForm.$invalid || editParForm.$pristine" class="btn-no-style" type="submit" ng-click="editParLevel(selectedList.listid, item)"><span class="large-icon text-green icon-checkmark"></span></button>
            </form>
            <span class="visible-print">{{item.parlevel}}</span>
          </td>
          <td class="table-icon hidden-drag table-actions">
            <a class="hidden-print icon-plus2" ng-mouseleave="displayedItems.isContextMenuDisplayed=false" ng-mouseenter="displayedItems.isContextMenuDisplayed = true"><div context-menu class="context-menu__in-list"></div></a>
            <a confirmed-click="deleteItem(selectedList, item)" ng-confirm-click="Are you sure you want to delete item {{item.itemnumber}}?"><span class="text-red icon-cross"></span></a>
            <a><span class="hidden-print text-light visible-xs-inline visible-sm-inline icon-ellipsis" ng-click="showDetails = !showDetails;"></span></a>
          </td>
        </tr>
        <tr ng-repeat-end ng-class="{ odd : $odd, even: $even }" ng-show="showDetails" class="table-striped__mobile-details">
          <td colspan="5">
            <div>
              <p>Pack/Size: {{item.packsize}}</p>
            </div>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr ng-show="(selectedList.items.length === 0 || !selectedList.items) && selectedList">
          <td colspan="7">There are no products in this list.</td>
        </tr>
      </tfoot>
    </table>

    <div class="text-center sub-content" loading-spinner="loadingResults"></div>
  </div>
</div>