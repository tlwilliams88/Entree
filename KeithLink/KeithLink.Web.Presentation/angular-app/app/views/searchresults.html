<div page-header-bar>
  <div header-message>
    {{pageTitle}}    
  </div>

  <div header-buttons>
    <a class="btn btn-icon btn-default" title="Print" ng-click="print()"><span class="icon-printer"></span></a>
    <a class="btn btn-icon btn-default" title="Export" ng-click="openExportModal()"><span class="icon-export"></span></a>
  </div>
</div>

<!-- Desktop subheader bar -->
<div class="row page-subheader-bar hidden-xs hidden-sm">
  <div class="col-md-12 page-subheader-bar__container">
    <div class="page-subheader-bar__message">
      <div ng-repeat="bc in breadcrumbs"><a ng-click="bc.click(bc.clickData)">{{bc.displayText}} </a> <span>>></span></div>
    </div>
  </div>
</div>

<!-- Mobile subheader bar -->
<div class="row page-subheader-bar hidden-md hidden-lg">
  <div class="col-md-12 page-subheader-bar__container">
    <div class="page-subheader-bar__message" style="width: calc(100% - 80px)">
      {{featuredBreadcrumb.displayText}}
    </div>
    <button type="button" ng-click="hideMobileFilters = ! hideMobileFilters"  class="nowrap hidden-print btn-no-style page-subheader-bar__button button-right">
      Filter <span ng-show="filterCount > 0">({{filterCount}})</span><span class="icon-arrow-down5"></span>
    </button>
  </div>
</div>

<!-- Mobile Filters -->

<div class="row" ng-hide="hideMobileFilters">
  <div class="col-xs-9 col-xs-offset-3 mobile-filter filters">
    <div class="row">

      <accordion close-others="oneAtATime">
        <accordion-group is-open="status.openCategories" ng-show="facets.categories.available.length > 0">
        <accordion-heading>
        Categories<i class="pull-right" ng-class="{'icon-arrow-up6': status.openCategories, 'icon-arrow-down7': !status.openCategories}"></i>
      </accordion-heading>
      <div ng-repeat="category in facets.categories.available" class="panel panel-default">
        <div class="panel-body">
          <a ng-click="toggleSelection(facets.categories.selected, category.name)" ng-class="{active: facets.categories.selected.indexOf(category.name) > -1 || category.name === featuredBreadcrumb.displayText}">{{::category.categoryname}} 
          <span ng-show="category.count > 0">({{category.count}})</span></a>
        </div>
      </div>
    </accordion-group>
    <accordion-group is-open="status.openBrand" ng-show="facets.brands.available.length > 0">
    <accordion-heading>
    Brands<i class="pull-right" ng-class="{'icon-arrow-up6': status.openBrand, 'icon-arrow-down7': !status.openBrand}"></i>
  </accordion-heading>
  <div ng-repeat="brand in facets.brands.available" class="panel panel-default">
    <div class="panel-body">
      <input type="checkbox"
      value="brandValue_{{brand.name}}"
      id="brandId_{{brand.name}}"
      ng-checked="facets.brands.selected.indexOf(brand.name) > -1 || brand.name === featuredBreadcrumb.displayText"
      ng-disabled="brand.name === featuredBreadcrumb.displayText"
      ng-click="toggleSelection(facets.brands.selected, brand.name)">
      <label for="brandId_{{brand.name}}">{{::brand.name}} <span ng-show="brand.count > 0">({{brand.count}})</span></label>
    </div>
  </div>
</accordion-group>

<accordion-group is-open="status.openManufacturer" ng-show="facets.mfrname.available.length > 0">
  <accordion-heading>
  Manufacturers<i class="pull-right" ng-class="{'icon-arrow-up6': status.openManufacturer, 'icon-arrow-down7': !status.openManufacturer}"></i>
  </accordion-heading>
  <div ng-repeat="manufacturer in facets.mfrname.available" class="panel panel-default">
    <div class="panel-body">
      <input type="checkbox"
      value="manufacturerValue_{{manufacturer.name}}"
      id="manufacturerId_{{manufacturer.name}}"
      ng-checked="facets.mfrname.selected.indexOf(brand.name) > -1 || manufacturer.name === featuredBreadcrumb.displayText"
      ng-disabled="manufacturer.name === featuredBreadcrumb.displayText"
      ng-click="toggleSelection(facets.mfrname.selected, manufacturer.name)">
      <label for="manufacturerId_{{manufacturer.name}}">{{::manufacturer.name}} <span ng-show="manufacturer.count > 0">({{manufacturer.count}})</label>
    </div>
  </div>
</accordion-group>

<accordion-group is-open="status.openDietary" ng-show="facets.dietary.available.length > 0">
  <accordion-heading>
  Dietary<i class="pull-right" ng-class="{'icon-arrow-up6': status.openDietary, 'icon-arrow-down7': !status.openDietary}"></i>
  </accordion-heading>
  <div ng-repeat="diet in facets.dietary.available" class="panel panel-default">
    <div class="panel-body">
      <input type="checkbox"
      value="dietValue_{{diet.name}}"
      id="dietId_{{diet.name}}"
      ng-checked="facets.dietary.selected.indexOf(diet.name) > -1"
      ng-click="toggleSelection(facets.dietary.selected, diet.name)">
      <label for="dietId_{{diet.name}}">{{::diet.name}} <span ng-show="diet.count > 0">({{diet.count}})</label>
    </div>
  </div>
</accordion-group>
<accordion-group is-open="status.temp_zone" ng-show="facets.temp_zone.available.length > 0">
  <accordion-heading>
  Temp Zone<i class="pull-right" ng-class="{'icon-arrow-up6': status.temp_zone, 'icon-arrow-down7': !status.temp_zone}"></i>
  </accordion-heading>
  <div ng-repeat="temp_zone in facets.temp_zone.available" class="panel panel-default">
    <div class="panel-body">
      <input type="checkbox"
      value="specValue_{{temp_zone.name}}"
      id="specId_{{temp_zone.name}}"
      ng-checked="facets.temp_zone.selected.indexOf(temp_zone.name) > -1"
      ng-click="toggleSelection(facets.temp_zone.selected, temp_zone.name)">
      <label for="specId_{{temp_zone.name}}"><span class="{{temp_zone.iconclass}}"></span>{{temp_zone.displayname}} <span ng-show="temp_zone.count > 0">({{temp_zone.count}})</label>
    </div>
  </div>
</accordion-group>
<accordion-group is-open="status.openSpecs" ng-show="facets.itemspecs.available.length > 0">
  <accordion-heading>
  Item Specifications<i class="pull-right" ng-class="{'icon-arrow-up6': status.openSpecs, 'icon-arrow-down7': !status.openSpecs}"></i>
  </accordion-heading>
  <div ng-repeat="spec in facets.itemspecs.available" class="panel panel-default">
    <div class="panel-body">
      <input type="checkbox"
      value="specValue_{{spec.name}}"
      id="specId_{{spec.name}}"
      ng-checked="facets.itemspecs.selected.indexOf(spec.name) > -1"
      ng-click="toggleSelection(facets.itemspecs.selected, spec.name)">
      <label for="specId_{{spec.name}}"><span class="{{spec.iconclass}}"></span>{{::spec.displayname}} <span ng-show="spec.count > 0">({{spec.count}})</label>
    </div>
  </div>
</accordion-group>
<accordion-group is-open="status.openCatalogs" ng-show="(bekItemCount + unfiItemCount - totalcount) > 0">
  <accordion-heading>Catalogs<i class="pull-right" ng-class="{'icon-arrow-up6': status.openCatalogs, 'icon-arrow-down7': !status.openCatalogs}"></i></accordion-heading>
    <div class="panel panel-default">
      <div class="panel-body">
          <a ng-click="bekCatalogSwitch()" ng-show="$state.params.catalogType != 'BEK' && bekItemCount > 0">Main ({{bekItemCount}})</a>
          <a ng-click="unfiCatalogSwitch()" ng-show="$state.params.catalogType != 'UNFI' && unfiItemCount > 0 && selectedUserContext.customer.canViewUNFI">Natural and Organic ({{unfiItemCount}})</a>
      </div>
    </div>
</accordion-group>
          
</accordion>

</div>
</div>
</div>

<div class="row top-offset">

  <!-- Filters -->
  
  <div class="col-sm-3 hidden-xs hidden-sm search-results__filters">
    <div class="row" ng-show="facets.categories.available.length > 0">
      <div class="col-sm-12">
        <h3>Categories<span style="font-size:.65em;"><a class="pull-right" ng-click="clearFacets()">Clear Filters</a></span></h3>
          <ul class="nav search-results__category">
            <li ng-repeat="category in facets.categories.available | orderBy: '-count'">
              <a
              ng-click="toggleSelection(facets.categories.selected, category.name)" 
              ng-class="{active: facets.categories.selected.indexOf(category.name) > -1 || category.name === featuredBreadcrumb.displayText}">
              {{::category.categoryname}} 
              <span ng-show="category.count > 0">({{category.count}})</span>
            </a>
          </li>
        </ul>
    </div>
  </div>

<div>
  <div class="row" ng-show="facets.brands.available.length > 0">
    <div class="col-sm-12">
      <h3>Brands</h3>
      <ul class="nav search-results__facets">
        <li ng-repeat="brand in facets.brands.available | orderBy: 'name'">
          <input 
            type="checkbox"
            value="brandValue_{{brand.name}}"
            id="brandId_{{brand.name}}"
            ng-checked="facets.brands.selected.indexOf(brand.name) > -1 || brand.name === featuredBreadcrumb.displayText"
            ng-disabled="brand.name === featuredBreadcrumb.displayText"
            ng-click="toggleSelection(facets.brands.selected, brand.name)"
            class="input-margin-5px">
          <label for="brandId_{{brand.name}}">{{::brand.name}} <span ng-show="brand.count > 0">({{brand.count}})</span></label>
        </li>
      </ul>
    </div>
  </div>
  <div class="row" ng-show="facets.dietary.available.length > 0">
    <div class="col-sm-12">
      <h3>Manufacturers</h3>
        <ul class="nav search-results__facets">
          <li class="facet-checkbox" ng-repeat="manufacturer in facets.mfrname.available | orderBy: '-count'">
            <input 
              type="checkbox"
              value="manufacturerValue_{{manufacturer.name}}"
              id="manufacturerId_{{manufacturer.name}}"
              ng-checked="facets.mfrname.selected.indexOf(manufacturer.name) > -1 || manufacturer.name === featuredBreadcrumb.displayText"
              ng-disabled="manufacturer.name === featuredBreadcrumb.displayText"
              ng-click="toggleSelection(facets.mfrname.selected, manufacturer.name)"
              class="input-margin-5px">
            <label for="manufacturerId_{{manufacturer.name}}">{{::manufacturer.name}} <span ng-show="manufacturer.count > 0">({{manufacturer.count}})</span></label>
          </li>
        </ul>
    </div>
  </div>
  <div class="row" ng-show="facets.dietary.available.length > 0">
    <div class="col-sm-12">
      <h3>Dietary</h3>
        <ul class="nav search-results__facets">
          <li class="facet-checkbox" ng-repeat="diet in facets.dietary.available | orderBy: '-count'">
            <input 
              type="checkbox"
              value="dietValue_{{diet.name}}"
              id="dietId_{{diet.name}}"
              ng-checked="facets.dietary.selected.indexOf(diet.name) > -1"
              ng-click="toggleSelection(facets.dietary.selected, diet.name)"
              class="input-margin-5px">
            <label class="text-capitalize" for="dietId_{{diet.name}}">{{::diet.name}} <span ng-show="diet.count > 0">({{diet.count}})</span></label>
          </li>
        </ul>
    </div>
  </div>
  <div class="row" ng-show="facets.temp_zone.available.length > 0">
    <div class="col-sm-12">
      <h3>Temp Zone</h3>
        <ul class="nav search-results__facets">
          <li class="facet-checkbox" ng-repeat="temp_zone in facets.temp_zone.available | orderBy: '-count'">
            <input 
              type="checkbox"
              value="temp_zoneValue_{{temp_zone.name}}"
              id="dietId_{{temp_zone.name}}"
              ng-checked="facets.temp_zone.selected.indexOf(temp_zone.name) > -1"
              ng-click="toggleSelection(facets.temp_zone.selected, temp_zone.name)"
              class="input-margin-5px">
            <label class="text-capitalize" for="dietId_{{temp_zone.name}}">{{::temp_zone.description}} <span ng-show="temp_zone.count > 0">({{temp_zone.count}})</span></label>
          </li>
        </ul>
    </div>
  </div>
  <div class="row" ng-show="facets.itemspecs.available.length > 0">
    <div class="col-sm-12">
      <h3>Item Specifications</h3>
        <ul class="nav search-results__facets">
          <li ng-repeat="spec in facets.itemspecs.available | orderBy: '-count'">
            <input 
              type="checkbox"
              value="specValue_{{spec.name}}"
              id="dietId_{{diet.name}}"
              ng-checked="facets.itemspecs.selected.indexOf(spec.name) > -1"
              ng-click="toggleSelection(facets.itemspecs.selected, spec.name)"
              class="input-margin-5px">
            <label for="specId_{{spec.name}}"><span class="{{spec.iconclass}}"></span>{{::spec.displayname}} <span ng-show="spec.count > 0">({{spec.count}})</span></label>
          </li>
        </ul>
    </div>
  </div>
    <div class="row" ng-show="(bekItemCount + unfiItemCount - totalcount) > 0">
      <div class="col-sm-12">
        <h3>Catalogs</h3>
          <a ng-click="bekCatalogSwitch()" ng-show="$state.params.catalogType != 'BEK' && bekItemCount > 0">Main ({{bekItemCount}})</a>
          <a ng-click="unfiCatalogSwitch()" ng-show="$state.params.catalogType != 'UNFI' && unfiItemCount > 0 && selectedUserContext.customer.canViewUNFI">Natural and Organic ({{unfiItemCount}})</a>
      </div>
    </div>
  </div>
</div>

<!-- Search Results -->
  <div class="col-xs-12 col-sm-12 col-md-9 col-lg-8">
    <div >
      <pagination
        ng-show="totalProducts > pagingPageSize"
        total-items="totalProducts" 
        ng-model="currentPage" 
        items-per-page="pagingPageSize" 
        max-size="10" 
        boundary-links="true" 
        rotate="false" 
        ng-change="blockUIAndChangePage(this); blur();" 
        class="pagination">
      </pagination> 
    </div>
    <div class="row" ng-show="products.length !== 0">
      <div class="col-sm-12 col-xs-12">
        <h2 class="pull-left" >Search Results</h2>
        <span style="margin-top:25px;" class="pull-right">{{rangeStart - rangeStartOffset}} - {{rangeEnd}} of {{totalProducts}} Items</span>
          <div class="pull-right" style="margin-bottom:5px;">
            <div class="input-group">
              <div class="input-group-btn">
                <div class="pull-right">
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{selectedSortParameter}}<span class="caret margin-left-5"></span></button>
                    <ul class="dropdown-menu">
                      <li ng-repeat="sortParameter in sortParameters" >
                        <a ng-click="selectSortParameter(sortParameter.name, sortParameter.value)">{{sortParameter.name}}</a>
                      </li>
                    </ul>
                  <button class="btn btn-default" type="button" ng-click="sortResults('asc', sortParametervalue)">Asc </button><span >/</span><button class="btn btn-default" type="button" ng-click="sortResults('desc', sortParametervalue)" > Desc</button>
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>
    <div context-menu favorite-item-click-handlers >
      <div>
        <ul fast-repeat="item in products" class="searchResults">
          <li class="block-display" style="list-style:none;">
            <div style="padding: 15px 0 20px 0" >
              <div class="inline-block-display" style="width:100%;">
                <div class="pull-left-xs inline-block-display">
                  <div>
                    <div>
                      <a class="block-display" style="margin-top:5px; margin-bottom:0;" ng-click="goToItemDetails(item)">{{item.itemnumber}}</a>
                    <h3 class="block-display">
                      <a ng-click="goToItemDetails(item)">{{item.name}} </a>
                    </h3>
                    <h5 class="block-display"> 
                    <span ng-if="item.brand_extended_description"> by <a ui-sref="menu.catalog.products.list({ type: 'brand', id: item.brand_control_label })">{{item.brand_extended_description}}</a><span ng-if="isOrderEntryCustomer" class="large-icon hideIconName displayIconName" favorite-icons></span>
                      <span
                        ng-if="(canManageLists || canCreateOrders || canSubmitOrders) && canOrderItem(item)" 
                        context-menu-template
                        class="context-menu-template context-menu__in-list hidden-print hideIconName displayIconName">
                          <a class="icon-plus2"></a>
                        </span></span>
                    <span ng-if="!item.brand_extended_description">{{item.brand}}</span>
                    <span ng-if="isOrderEntryCustomer" class="large-icon hideIconBrand displayIconBrand" favorite-icons></span>
                    <span
                      ng-if="(canManageLists || canCreateOrders || canSubmitOrders) && canOrderItem(item)" 
                      context-menu-template
                      class="context-menu-template context-menu__in-list hidden-print hideIconBrand displayIconBrand">
                        <a class="icon-plus2"></a>
                    </span>
                    </h5>
                    </div>
                    <h6>
                      Manufacturer: {{item.manufacturer_name}}
                    </h6>
                    <h6>
                      {{item.description}}
                    </h6>
                    <h6>
                      Pack/Size: {{item.packsize}}
                    </h6>
                    <h6 class="nowrap" item-icons></h6>
                    <h6 class="input-col" ng-if="canSeePrices">
                      <ng-form name="eachForm" ng-if="hasPackagePrice(item)">
                        Each: <input type="checkbox" ng-model="item.each" id="each" name="each" />
                        <label for="each"></label>
                      </ng-form>
                    </h6>
                    <h6 ng-if="canSeePrices">
                      <span ng-if="hasPrice(item.unitprice)">Portion Cost: {{item.unitprice | currency}}</span>
                    </h6>
                    <h6 ng-if="canSeePrices">
                      <span ng-if="hasCasePrice(item)">Price: {{(item.each ? item.packageprice : item.caseprice) | currency}}</span>
                      <span class="text-small" tooltip="Catch weight pricing" ng-if="item.catchweight">LB</span>
                    </h6>
                  </div>
                </div>
                <div class="pull-right-lg pull-right-md pull-right-sm pull-left-xs search-result-image-container" ng-show="item.productimages.length > 0">
                  <img class="search-result-images" ng-src="{{item.productimages[0].url}}" alt=""/>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <pagination
        ng-show="totalProducts > pagingPageSize"
        total-items="totalProducts" 
        ng-model="currentPage" 
        items-per-page="pagingPageSize" 
        max-size="10" 
        boundary-links="true" 
        rotate="false" 
        ng-change="blockUIAndChangePage(this)" 
        class="pagination">
      </pagination> 
    </div>
  </div>

    <div class="col-sm-5 no-results" ng-if="!searchMessage && products.length === 0 && !loadingResults">
      <p colspan="9">No products found. Please try another search.</p>
    </div>

    <div class="text-red" ng-show="searchMessage">{{searchMessage}}</div>

    <div class="text-center" loading-spinner="loadingResults"></div>
  </div>
</div>