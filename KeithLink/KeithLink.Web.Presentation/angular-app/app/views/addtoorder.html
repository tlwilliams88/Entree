<div page-header-bar>
  <div header-message>
    Add To Order
    <button class="btn-lg btn btn-primary pull-right hidden-md hidden-lg hidden-print" ng-click="saveAndRetainQuantity(true)" ng-disabled="addToOrderForm.$invalid">Save</button>
    <button class="btn-lg btn btn-danger pull-right hidden-md hidden-lg hidden-print" style="margin-right:3px;" ui-sref="menu.home" ng-click="setOrderCanceled()">Cancel Order</button>
  </div>
  <div class="pull-right margin-right-10 hidden-xs hidden-sm" ng-hide="invalidParams">
    <button class="btn-lg btn btn-danger pull-right-sm hidden-print" ng-click="cancelChanges();">Cancel</button>
    <button class="btn-lg btn btn-primary pull-right-sm hidden-print" ng-click="saveAndRetainQuantity(true)" ng-disabled="addToOrderForm.$invalid">Save</button>
    <button class="btn-lg btn btn-primary pull-right-sm hidden-print" style="background-color: #04a773;" ng-click="addToOrderForm.$setPristine(); saveAndContinue()">Proceed to Checkout</button>
    <button title="Print" class="btn btn-default btn-icon" ng-click="saveBeforePrint()">
      <span class="icon-printer"></span>
    </button>
    <button id="quickOrder" class="btn btn-default btn-icon-right" title="Quick Order Entry" ng-click="saveBeforeQuickAdd()">
      <span class="glyphicon glyphicon-list-alt"></span>
    </button>
    <button id="deleteCart" class="btn btn-default btn-icon" ng-if="selectedCart.id" ng-click="deleteCart(selectedCart.id)">
      <span class="icon-trash"></span>
    </button>
  </div>
</div>

<div loading-spinner="invalidParams"></div>

<div ng-hide="invalidParams">

  <button class="btn-lg btn btn-primary col-xs-12 hidden-md hidden-lg hidden-print" style="margin-left: -7px; background-color: #04a773;" ng-click="addToOrderForm.$setPristine(); saveAndContinue()">Proceed to Checkout</button>

  <div ng-show="selectedList.itemCount > pagingPageSize && showingPagination == 'true'">
   <pagination
    total-items="selectedList.itemCount"
    ng-model="currentPage"
    items-per-page="pagingPageSize"
    max-size="10"
    boundary-links="true"
    rotate="false"
    ng-change="blockUIAndChangePage(this)"
    class="pagination">
   </pagination>
  </div>

  <div class="row" ng-if="addToOrderForm.$invalid">
    <div class="col-xs-12 text-red">
      <span>Your form has some errors. Please fix these before adding items to an order.</span>
    </div>
  </div>

  <div class="row" ng-if="invalidValue">
    <div class="col-xs-12 text-red">
      <span>Please enter a quantity no greater than 999</span>
    </div>
  </div>
  <div class="row" ng-show="showingPagination == 'true'">
    <div class="col-xs-5" style="margin-top: 7px;" >
      <input id="useParlevel" name="useParlevel" type="checkbox" ng-model="useParlevel" ng-change="removeRowHighlightParLevel();">
      <label for="useParlevel">Use PAR Level</label>
    </div>
    <div class="col-xs-7 text-right" style="float:right; margin-top: 7px;" >
      Showing {{rangeStart}} - {{rangeEnd}} of  {{selectedList.itemCount}} Items
    </div>
  </div>

  <div class="row hidden-print">
    <div class="col-xs-12">
      <div class="row select-nav-bar no-margin" style="border-bottom: 1px solid #c3bc9c; margin-bottom: 10px;">
        <div class="no-border-right-sm info-box col-md-3 col-sm-6 col-xs-12 select-nav btn-group dropdown-toggle hand" dropdown is-open="showLists" ng-disabled="lists.length === 1">
          <span class="nav-description text-light">Select a List</span>
          <span class="nav-title">{{selectedList.name}}</span>
          <span class="pull-right caret text-dark"></span>
          <ul class="dropdown-menu col-xs-12 dropdown-menu-scroll" role="menu">
            <li ng-repeat="list in lists | sortLists" ng-if="list.listid !== selectedList.listid">
              <a ng-click="saveBeforeListChange(list, selectedCart)">
                {{list.name}}
              </a>
            </li>
          </ul>
        </div>

        <div class="info-box col-md-3 col-sm-6 col-xs-12 select-nav btn-group" id="addToOrderTable">
          <span class="nav-description text-light" ng-if="isChangeOrder" >Selected Order</span>
          <span class="nav-description text-light" ng-if="!isChangeOrder" >Cart Name</span>
          <span class="nav-title" ng-hide="isRenaming">{{selectedCart.name || selectedCart.invoicenumber || 'New Cart'}}
            <span ng-if="::!isChangeOrder" class="icon-pencil hand large-icon text-light" ng-click="startRenamingCart(selectedCart.name)"></span>
          </span>
          <span ng-show="isRenaming">
            <form name="renameCartForm">
              <input type="text" id="cartName" ng-model="tempCartName" focus-me="isRenaming" required>
              <button type="submit" class="btn-no-style icon-checkmark large-icon hand text-green" ng-disabled="renameCartForm.$invalid" ng-click="renameCart(selectedCart.id, tempCartName)"></button>
              <span class="icon-cross large-icon hand text-red" ng-click="isRenaming = false"></span>
            </form>
          </span>
        </div>

        <div class="col-md-3 col-sm-6 col-xs-12 btn-group info-box hand no-border-right-sm dropdown-toggle" dropdown is-open="showShipDates">
          <span class="nav-description text-light">Ship Date</span>
          <span class="nav-title">
            {{(selectedCart.requestedshipdate | formatDate) || 'Select a date...' }}
          </span>
          <span class="pull-right caret text-dark"></span>
          <div class="dropdown-menu">
            <table class="table no-margin">
              <tr style="cursor:default">
                <td></td>
                <td>Ship Date</td>
                <td>Submit By</td>
              </tr>
              <tr ng-repeat="shipDate in shipDates" ng-click="selectedCart.requestedshipdate = shipDate.shipdate; addToOrderForm.$setDirty(); saveAndRetainQuantity(true);">
                <td>{{shipDate.dayofweek}}</td>
                <td class="nowrap">{{shipDate.shipdate}}</td>
                <td class="nowrap">{{shipDate.cutoffdatetime | formatDateWithTimezone}}</td>
              </tr>
            </table>
          </div>
        </div>

        <div class="col-md-3 col-sm-6 col-xs-12 info-box">
          <span class="nav-description text-light">Cart Info</span>

          <span class="nav-title">
            {{(itemCount || selectedCart.items.length ||  '0') +((itemCount === 1 || (!itemCount && selectedCart.items.length === 1)) ? ' Item / ' : ' Items / ') +
             (piecesCount || selectedCart.piececount || '0') +((piecesCount === 1 || (!piecesCount && selectedCart.piececount === 1)) ? ' Piece' : ' Pieces')}}
          </span>
          <span class="nav-subtotal pull-right text-green">{{selectedCart.subtotal | currency}}</span>
        </div>

      </div>
    </div>
  </div>

  <div class="visible-print row sub-content">
    <div class="col-xs-3">{{selectedList.name}}</div>
    <div class="col-xs-3">{{selectedCart.name || selectedCart.ordernumber || 'New Cart'}}</div>
    <div class="col-xs-2">{{( selectedCart.requestedshipdate | formatDate) || 'Select a date...' }}</div>
    <div class="col-xs-2">{{itemCount || '0'}} Items</div>
    <div class="col-xs-2 text-right">{{subtotal | currency}}</div>
  </div>

  <form
    novalidate
    name="addToOrderForm"
    class="style-validation-errors padding-right-15"
    autocomplete="off">
    <div class="table-addtoorder">
      <tabset class="tabset tab-border pull-left" style="width: 100%; padding-bottom: 10px;">
      <tab class="text-center" ng-init="showPagination('true')" ng-click="showPagination('true')">
      <tab-heading><span class="icon-text" style="padding-right: 5px; color: #3E9DCD"></span>{{selectedList.name}}</tab-heading>
        <form name="orderSearchForm" class="hidden-print">
            <div class="input-group input-group-lg">
              <input               
                id="searchBar"
                ng-model="orderSearchTerm"
                type="text"
                class="form-control mousetrap"
                placeholder="Search current list by keyword, item # or label">
              <span class="input-group-btn" style="background-color: #F3F1EB; border-radius: 4px;">
                <button 
                    class="btn-default btn"
                    ng-disabled="!orderSearchTerm || orderSearchTerm.length === 0"
                    ng-click="filterItems(orderSearchTerm)"
                    type="submit">
                    <span 
                      style="font-size: 16px;"
                      class="icon-search">
                    </span>
                </button>
                  <button 
                    class="btn-default btn"
                    ng-disabled="!orderSearchTerm || orderSearchTerm.length === 0"
                    ng-click="clearFilter(); orderSearchTerm = ''"
                    type="submit">
                    <span
                      style="font-size: 18px;"
                      class="icon-cross">
                    </span>
                </button>
              </span>
            </div>
            <div style="margin-left: 60px;" ng-if="universalSearchForm.$error.searchInputInvalid"><p class="text-red">Invalid Input. No special characters allowed in search terms.</p></div>
        </form>
        <table
        class="table table-border"
        navigate-table="lists">
        <thead>
          <tr fsm-sticky-header scroll-body="'.table-addtoorder'" scroll-stop="0" current-page="currentPage">
            <th class="sort-col-header" ng-click="sortList('position',sort[0].order)">
              <span># <span sort-icons field="'position'" sortorder="sort[0].order" sortby="sort[0].field"></span></span>
            </th>
            <th class="sort-col-header" ng-click="sortList('itemnumber',sort[0].order)">
             Item
              <span># <span sort-icons field="'itemnumber'" sortorder="sort[0].order" sortby="sort[0].field"></span></span>
            </th>
            <th class="hidden-mobile-visible-print sort-col-header" ng-click="sortList('itemclass',sort[0].order)">
              <span>Category <span sort-icons field="'itemclass'" sortorder="sort[0].order" sortby="sort[0].field"></span></span>
            </th>
            <th class="hidden-mobile-visible-print sort-col-header notes-col" ng-click="sortList('notes',sort[0].order)">
              <span>Notes <span sort-icons field="'notes'" sortorder="sort[0].order" sortby="sort[0].field"></span></span>
            </th>
            <th  class="sort-col-header hidden-mobile-visible-print" ng-click="sortList('label',sort[0].order)">
              <span>Label <span sort-icons field="'label'" sortorder="sort[0].order" sortby="sort[0].field"></span></span>
            </th>
            <th class="hidden-mobile-visible-print">
              Pack/Size
            </th>
            <th class="hidden-mobile-visible-print sort-col-header" ng-click="sortList('brandextendeddescription',sort[0].order)">
              <span>Brand <span sort-icons field="'brandextendeddescription'" sortorder="sort[0].order" sortby="sort[0].field"></span></span>
            </th>
            <th class="sort-col-header" ng-click="sortList('name',sort[0].order)">
              <span>Name<span sort-icons field="'name'" sortorder="sort[0].order" sortby="sort[0].field"></span></span>
            </th>
            <th class="hidden-mobile-visible-print sort-col-header" ng-if="selectedList.is_contract_list" ng-click="sortList('category',sort[0].order)">
              <span>Contract Category<span sort-icons field="'category'" sortorder="sort[0].order" sortby="sort[0].field"></span></span>
            </th>
            <th  class="hidden-mobile-visible-print"></th>
            <th class="hidden-mobile" ng-if="useParlevel">
              PAR
            </th>
            <th  class="hidden-mobile text-center" ng-if="useParlevel">
              On Hand
            </th>
            <th>
             Qty
            </th>
            <th class="hidden-mobile-visible-print">
              Each
            </th>
            <th class="hidden-mobile-visible-print">
              Price
            </th>
            <th style="text-align:left;" class="hidden-mobile-visible-print">
            Average Weekly </br> Usage
            </th>
            <th class="hidden-mobile-visible-print">
              Ext Price
            </th>
            <th>
            </th>
          </tr>
        </thead>

        <tbody ng-hide="(selectedList.items.length === 0 || !selectedList.items) || item.custominventoryitemid || (item.packageprice == 0.00 && item.caseprice == 0.00 && item.unitprice == 0) && selectedList" ng-repeat="item in selectedList.items.slice(startingPoint, endPoint) track by item.listitemid" ng-class="{ oddrow : $odd }">

          <tr id="rowForFocus">
            <td>
              {{::item.position}}
              <a ng-if="$last || clearedWhilePristine" ng-init="postPageLoadInit();"></a>
            </td>
            <td>
              <a ng-if="item.isvalid && item.catalog_id && item.catalog_id.indexOf('unfi') == 0" ui-sref="menu.catalog.products.details({ itemNumber : item.itemnumber, catalogType: 'UNFI' })">{{::item.itemnumber}}</a>
              <a ng-if="item.isvalid && (!item.catalog_id || item.catalog_id.indexOf('unfi') != 0)" ui-sref="menu.catalog.products.details({ itemNumber : item.itemnumber })">{{::item.itemnumber}}</a>
              <span ng-if="!item.isvalid" tooltip="Contact your DSR for more info.">{{::item.itemnumber}}</span>
            </td>
            <td class="hidden-mobile-visible-print">
              {{::item.class}}
            </td>
            <td class="hidden-mobile-visible-print notes-col">
                {{::item.notes}}
            </td>
            <td class="hidden-mobile-visible-print label-col">
              {{::item.label}}
            </td>
            <td class="hidden-mobile-visible-print">
              {{::item.packsize}}
            </td>
            <td class="hidden-mobile-visible-print">
              {{::item.brand_extended_description}}
            </td>
            <td>
             <span ng-if="item.isvalid">{{::item.name}}</span>
             <span ng-if="!item.isvalid">Invalid item</span>
            </td>
            <td class="hidden-mobile-visible-print" ng-if="selectedList.is_contract_list">
              {{::item.category}}
            </td>
            <td class="hidden-mobile-visible-print" item-icons>
            </td>
            <td ng-if="useParlevel" class="hidden-mobile parLevelField">
              {{::item.parlevel}}
            </td>
            <td ng-if="useParlevel" class="input-col text-center hidden-mobile parlevelInput" style="max-width:120px;" >
              <ng-form name="parlevelForm" class="counter-container" style="white-space:nowrap;" ng-if="item.canOrder && item.isvalid">
              <!--  ON HAND AMOUNT -->
              <button type="button" class="btn btn-warning icon-minus3 hidden-lg"  ng-click="item.onhand = item.onhand -1; onItemOnHandAmountChanged(item)"></button>
              <input
                  type="tel"
                  id="onHand"
                  ng-focus="this.select(); onItemOnHandAmountChanged(item)"
                  ng-change="onItemOnHandAmountChanged(item)"
                  focus-me="$first"
                  ng-blur="confirmQuantity('onhand', item, item.onhand);"
                  class="dropdown-toggle input-number text-right mousetrap"
                  ng-class="{ tabstop: useParlevel }"
                  numeric-validation
                  ng-model="item.onhand"
                  name="onhand"
                  row-highlight
                  />
              <button type="button" class="btn btn-warning icon-plus3 hidden-lg" ng-click="item.onhand = item.onhand + 1; onItemOnHandAmountChanged(item)"></button>
              </ng-form>
            </td>
            <td class="input-col nowrap">
              <!--  QUANTITY -->
              <span class="hidden-mobile visible-print">{{::item.quantity}}</span>
              <ng-form class="hidden-print" name="quantityForm" ng-if="item.isvalid">
                <div counter ng-model="item.quantity" min="0" length="5" ng-hide="!item.canOrder"  ng-if="!useParlevel && item.canOrder"></div>
                <span  class="counter-container"  >
                 <button type="button" class="btn btn-warning icon-minus3 hidden-lg show-mobile" ng-disabled = "item.quantity === 0" ng-if="useParlevel && item.canOrder"  ng-click="item.quantity = item.quantity -1;"></button>
                  <input
                  type="tel"
                  focus-me="$first"
                  ng-if="useParlevel && item.canOrder"
                  ng-blur="confirmQuantity('quantity', item, item.quantity);"
                  class="input-number text-right mousetrap"
                  ng-class="{ tabstop: !useParlevel }"
                  integer
                  ng-model="item.quantity"
                  row-highlight
                  />
              <button type="button" class="btn btn-warning icon-plus3 hidden-lg show-mobile" ng-if="useParlevel && item.canOrder" ng-click="item.quantity = item.quantity + 1;"></button>
              </span>
              </ng-form>
            </td>
            <td class="input-col hidden-mobile-visible-print">
              <ng-form name="eachForm" ng-if="item.hasPackagePrice && item.isvalid">
                <input type="checkbox" class="mousetrap" ng-checked = "!item.hasCasePrice || item.each" ng-disabled = "!item.hasCasePrice" ng-model="item.each" id="each" name="each"/>
                <label for="each"></label>
              </ng-form>
            </td>
            <td class="hidden-mobile-visible-print">
              <div ng-if="item.canOrder">
                {{item.each ? item.packageprice : item.caseprice | currency}}
                <span class="text-small" tooltip="Catch weight pricing" ng-if="item.catchweight">LB</span>
              </div>
            </td>
            <td  class="hidden-mobile-visible-print text-left" >
            <div style="max-width:60px;" ng-if="item.itemstatistics.packageaverage || item.itemstatistics.caseaverage ">
            <a>
              <div ng-if="item.each && item.itemstatistics.packageaverage"
                  tooltip="View order history for this item."
                  ng-click="openItemUsageSummaryModal(item)">
                    {{item.itemstatistics.packageaverage == 1 ? item.itemstatistics.packageaverage + ' Pack' : item.itemstatistics.packageaverage + ' Packs'}}
              </div>
            </a>
            <a>
              <div ng-if="!item.each && item.itemstatistics.caseaverage"
                  tooltip="View order history for this item."
                  ng-click="openItemUsageSummaryModal(item)">
                    {{item.itemstatistics.caseaverage == 1 ? item.itemstatistics.caseaverage + ' Case' : item.itemstatistics.caseaverage + ' Cases'}}
              </div>
            </a>
          </div>
          <div ng-click="openItemUsageSummaryModal(item)" ng-if="(!item.itemstatistics.packageaverage && item.each) || (!item.itemstatistics.caseaverage && !item.each)">
            None
          </div>
           </td>
            <td class="hidden-mobile-visible-print">
              <div ng-if="item.canOrder">
                {{item.extPrice | currency}}
              </div>
            </td>
            <td class="large-icon icon-col">
              <a class="visible-xs visible-sm"><span class="hidden-print text-light icon-ellipsis" ng-click="item.showDetails = !item.showDetails;"></span></a>
            </td>
          </tr>
          <tr ng-if="item.showDetails" ng-class="{ odd : $odd, even: $even }" class="mobile-details-row hidden-md hidden-lg">
            <td colspan="7">
              <table>
                <colgroup>
                  <col width="25%" />
                  <col width="75%" />
                </colgroup>
                <tr>
                  <td>Category</td>
                  <td>{{::item.class}}</td>
                </tr>
                <tr>
                  <td>Notes</td>
                  <td class="notes-col">{{::item.notes}}</td>
                </tr>
                <tr>
                  <td>Label</td>
                  <td class = "label-col">{{::item.label}}</td>
                </tr>
                <tr>
                  <td>Pack/Size</td>
                  <td>{{::item.packsize}}</td>
                </tr>
                <tr>
                  <td>Brand</td>
                  <td>{{::item.brand}}</td>
                </tr>
                <tr ng-if="selectedList.is_contract_list">
                  <td>Contract Category</td>
                  <td>{{::item.category}}</td>
                </tr>
                <tr>
                  <td item-icons></td>
                </tr>
                <tr ng-show="useParlevel">
                  <td>PAR Level</td>
                  <td>{{::item.parlevel}}</td>
                </tr>
                <tr ng-show="useParlevel && item.canOrder && item.isvalid">
                  <td>On Hand Amount</td>
                  <td class="input-col">
                    <ng-form name="parlevelForm_mobile">
                      <input
                        type="text"
                        class="input-number text-right mousetrap"
                        numeric-validation
                        ng-model="item.onhand"
                        ng-change="onItemOnHandAmountChanged(item)">
                    </ng-form>
                  </td>
                </tr>
                <tr ng-show="item.hasPackagePrice && item.isvalid">
                  <td>Each</td>
                  <td>
                    <ng-form name="eachForm_mobile">
                      <input type="checkbox" ng-model="item.each" ng-checked = "!item.hasCasePrice || item.each" class="mousetrap" ng-disabled="!item.hasCasePrice" id="each" name="each" />
                    </ng-form>
                  </td>
                </tr>
                <tr ng-show="item.canOrder">
                  <td>Price</td>
                  <td>
                    {{item.each ? item.packageprice : item.caseprice | currency}}
                    <span class="text-small" tooltip="Catch weight pricing" ng-if="item.catchweight">LB</span>
                  </td>
                </tr>
                <tr ng-show="item.canOrder">
                  <td>Average Weekly </br> Usage</td>
                  <td  ng-click="openItemUsageSummaryModal(item)">
                    <div ng-if="(item.itemstatistics.packageaverage !== 0 || item.itemstatistics.caseaverage !== 0)">
                      <a><div ng-show="item.each && item.itemstatistics.packageaverage" tooltip="View order history for this item." class="pull-left" >{{item.itemstatistics.packageaverage}} Packs</div></a>
                      <a><div ng-show="!item.each && item.itemstatistics.caseaverage" tooltip="View order history for this item." class="pull-left">{{item.itemstatistics.caseaverage}} Cases</div></a>
                  </div>
                  <div ng-show="(!item.itemstatistics.packageaverage && item.each) || (!item.itemstatistics.caseaverage && !item.each)">None</div>
                </td>
                </tr>
                <tr ng-show="item.canOrder">
                  <td>Ext Price</td>
                  <td>{{item.extPrice | currency}}</td>
                </tr>
              </table>
            </td>
          </tr>
        </tbody>
        <tfoot ng-show="showingPagination == 'true' && (selectedList.items.length === 0 || !selectedList.items)">
          <tr>
            <td colspan="17">
              There are no products to display.
            </td>
          </tr>
        </tfoot>
      </table>
    </tab>
    <tab class="text-center" ng-click="showPagination('false')" active="cartItems.active">
      <tab-heading><span class="icon-cart" style="padding-right: 5px; color: #3E9DCD"></span>Other Cart Items</tab-heading>
      <table
      class="table table-striped-rows table-border"
      navigate-table="lists">
      <thead>
        <tr>
          <th>Item #</th>
          <th class="hidden-mobile-visible-print">Notes</th>
          <th class="hidden-mobile-visible-print">Pack/Size</th>
          <th class="hidden-mobile-visible-print">Brand</th>
          <th>Name</th>
          <th>Qty</th>
          <th class="hidden-mobile-visible-print">Each</th>
          <th class="hidden-mobile-visible-print">Price</th>
          <th class="hidden-mobile-visible-print">Ext Price</th>
          <th></th>
        </tr>
      </thead>
      <tbody ng-if="!item.recommended" ng-repeat="item in filteredCartItems |  orderBy:'createddate':false">
        <tr ng-class="{ odd : $odd, even: $even }">
          <td>
            <a ng-if="item.isvalid && item.catalog_id && item.catalog_id.indexOf('unfi') == 0" ui-sref="menu.catalog.products.details({ itemNumber : item.itemnumber, catalogType : 'UNFI' })">{{::item.itemnumber}}</a>
            <a ng-if="item.isvalid && (!item.catalog_id || item.catalog_id.indexOf('unfi') != 0)" ui-sref="menu.catalog.products.details({ itemNumber : item.itemnumber })">{{::item.itemnumber}}</a>
            <span ng-if="!item.isvalid" tooltip="Contact your DSR for more info.">{{::item.itemnumber}}</span>
            <a ng-if="$last || clearedWhilePristine" ng-init="postPageLoadInit();"></a>
          </td>
          <td class="hidden-mobile-visible-print notes-col">
            {{::item.notes}}
          </td>
          <td class="hidden-mobile-visible-print">{{item.packsize}}</td>
          <td class="hidden-mobile-visible-print">{{item.brand}}</td>
          <td>
            <span ng-if="item.isvalid">{{::item.name}}</span>
            <span ng-if="!item.isvalid">Invalid item</span>
          </td>
          <td class="input-col nowrap">
            <ng-form class="hidden-print" name="quantityForm">
              <div counter ng-model="item.quantity" class="mousetrap" min="0" length="5"></div>
            </ng-form>
          </td>
          <td class="input-col hidden-mobile-visible-print">
            <ng-form name="eachForm" ng-if="::item.hasPackagePrice">
              <input type="checkbox" ng-checked = "!item.hasCasePrice || item.each" ng-disabled = "!item.hasCasePrice" class="mousetrap" ng-model="item.each" id="each" name="each" />
              <label for="each"></label>
            </ng-form>
          </td>
          <td ng-if="::!isChangeOrder" class="hidden-mobile-visible-print" >
            {{item.each ? item.packageprice : item.caseprice | currency}}
            <span class="text-small" tooltip="Catch weight pricing" ng-if="::item.catchweight">LB</span>
          </td>
          <td ng-if="::isChangeOrder" class="hidden-mobile-visible-print">
            {{item.price | currency}}
            <span class="text-small" tooltip="Catch weight pricing" ng-if="::item.catchweight">LB</span>
          </td>
          <td class="hidden-mobile-visible-print">
            {{item.extPrice | currency}}
          </td>
          <td class="large-icon icon-col">
            <a class="hidden-print visible-xs-inline visible-sm-inline" ng-click="showDetails = !showDetails;"><span class="text-light icon-ellipsis"></span></a>
          </td>
        </tr>
        <tr ng-if="showDetails" ng-class="{ odd : $odd, even: $even }" class="mobile-details-row hidden-md hidden-lg">
          <td colspan="11">
            <table>
              <colgroup>
                <col width="25%" />
                <col width="75%" />
              </colgroup>
              <tr>
                <td>Notes</td>
                <td class="notes-col">{{::item.notes}}</td>
              </tr>
              <tr>
                <td>Pack/Size</td>
                <td>{{::item.packsize}}</td>
              </tr>
              <tr>
                <td>Brand</td>
                <td>{{::item.brand}}</td>
              </tr>
              <tr ng-if="::item.hasPackagePrice">
                <td>Each</td>
                <td>
                  <input type="checkbox" value="" ng-checked = "!item.hasCasePrice || item.each" ng-disabled = "!item.hasCasePrice" class="mousetrap" name="each" id="each" ng-model="item.each">
                </td>
              </tr>
              <tr>
                <td>Price</td>
                <td ng-if="::!isChangeOrder">
                  {{item.each ? item.packageprice : item.caseprice | currency}}
                  <span class="text-small" tooltip="Catch weight pricing" ng-if="::item.catchweight">LB</span>
                </td>
                <td ng-if="::isChangeOrder">
                  {{item.price | currency}}
                  <span class="text-small" tooltip="Catch weight pricing" ng-if="::item.catchweight">LB</span>
                </td>
              </tr>
              <tr>
                <td>Ext Price</td>
                <td>{{item.extPrice | currency}}</td>
              </tr>
            </table>
          </td>
        </tr>
      </tbody>
      <tfoot ng-show="cartItems.active && filteredCartItems.length == 0">
          <tr>
            <td colspan="17">
              There are no products to display.
            </td>
          </tr>
        </tfoot>
    </table>
  </tab>
  <tab
      ng-if="showRecommendedItems == true"
      class="text-center"  
      ng-click="updateRecommendedItems(selectedCart.items); showPagination('false');"
      analytics-on 
      analytics-category="Recommended-Item-Add-To-Order" 
      analytics-event="Open Recommended Items Tab">
        <tab-heading ng-style="recommendedItems.length > 0 && {'color' : '#3E9DCD'}"><span class="icon-thumbsup" style="padding-right: 5px;"></span>Recommended Items <span ng-show="recommendedItems.length > 0">({{recommendedItems.length}})</span><span class="icon-help" style="padding-left: 5px; padding-top: 2px;" tooltip="Recommended Items are based on what is currently in your cart."></span></tab-heading>
        <table
        class="table table-border"
        navigate-table="lists">
        <thead>
          <tr fsm-sticky-header scroll-body="'.table-addtoorder'" scroll-stop="0" current-page="currentPage">
            <th class="sort-col-header">
             Item
              <span># <span></span></span>
            </th>
            <th class="hidden-mobile-visible-print sort-col-header">
              <span>Category <span></span></span>
            </th>
            <th class="hidden-mobile-visible-print sort-col-header notes-col">
              <span>Notes <span></span></span>
            </th>
            <th  class="sort-col-header hidden-mobile-visible-print">
              <span>Label <span></span></span>
            </th>
            <th class="hidden-mobile-visible-print">
              Pack/Size
            </th>
            <th class="hidden-mobile-visible-print sort-col-header">
              <span>Brand <span></span></span>
            </th>
            <th class="sort-col-header">
              <span>Name<span></span></span>
            </th>
            <th  class="hidden-mobile-visible-print"></th>
            <th>
             Qty
            </th>
            <th class="hidden-mobile-visible-print">
              Each
            </th>
            <th class="hidden-mobile-visible-print">
              Price
            </th>
            <th style="text-align:left;" class="hidden-mobile-visible-print">
            Average Weekly </br> Usage
            </th>
            <th class="hidden-mobile-visible-print">
              Ext Price
            </th>
            <th>
            </th>
          </tr>
        </thead>

        <tbody ng-repeat="item in recommendedItems | limitTo: 10" ng-class="{ oddrow : $odd }">

          <tr id="rowForFocus">
            <td>
              <a ng-if="item.isvalid && item.catalog_id && item.catalog_id.indexOf('unfi') == 0" ui-sref="menu.catalog.products.details({ itemNumber : item.itemnumber, catalogType: 'UNFI' })">{{::item.itemnumber}}</a>
              <a ng-if="item.isvalid && (!item.catalog_id || item.catalog_id.indexOf('unfi') != 0)" ui-sref="menu.catalog.products.details({ itemNumber : item.itemnumber })">{{::item.itemnumber}}</a>
              <span ng-if="!item.isvalid" tooltip="Contact your DSR for more info.">{{::item.itemnumber}}</span>
            </td>
            <td class="hidden-mobile-visible-print">
              {{::item.class}}
            </td>
            <td class="hidden-mobile-visible-print notes-col">
                {{::item.notes}}
            </td>
            <td class="hidden-mobile-visible-print label-col">
              {{::item.label}}
            </td>
            <td class="hidden-mobile-visible-print">
              {{::item.packsize}}
            </td>
            <td class="hidden-mobile-visible-print">
              {{::item.brand_extended_description}}
            </td>
            <td>
             <span ng-if="item.isvalid">{{::item.name}}</span>
             <span ng-if="!item.isvalid">Invalid item</span>
            </td>
            <td class="hidden-mobile-visible-print" item-icons>
            </td>
            <td class="input-col nowrap">
              <!--  QUANTITY -->
              <span class="hidden-mobile visible-print">{{::item.quantity}}</span>
              <ng-form class="hidden-print" name="quantityForm" ng-if="item.isvalid">
                <div counter ng-hide="!item.canOrder"  ng-if="!useParlevel && item.canOrder" ng-model="item.quantity" function="updateCartWithRecommendedItems(item)" ng-focus="oldVal = item.quantity" min="0" length="5"></div>
                <span  class="counter-container"  >
                 <button type="button" class="btn btn-warning icon-minus3 hidden-lg show-mobile" ng-disabled = "item.quantity === 0" ng-if="item.canOrder"  ng-click="item.quantity = item.quantity -1;"></button>
                  <input
                  type="tel"
                  focus-me="$first"
                  ng-change="updateCartWithRecommendedItems(item); confirmQuantity('quantity', item, item.quantity);"
                  class="input-number text-right mousetrap"
                  ng-class="{ tabstop: !useParlevel }"
                  integer
                  ng-model="item.quantity"
                  row-highlight
                  />
              <button type="button" class="btn btn-warning icon-plus3 hidden-lg show-mobile" ng-if="useParlevel && item.canOrder" ng-click="item.quantity = item.quantity + 1;"></button>
              </span>
              </ng-form>
            </td>
            <td class="input-col hidden-mobile-visible-print">
              <ng-form name="eachForm" ng-if="item.hasPackagePrice && item.isvalid">
                <input type="checkbox" class="mousetrap" ng-checked = "!item.hasCasePrice || item.each" ng-disabled = "!item.hasCasePrice" ng-model="item.each" id="each" name="each"/>
                <label for="each"></label>
              </ng-form>
            </td>
            <td class="hidden-mobile-visible-print">
              <div>
                {{item.each ? item.packageprice : item.caseprice | currency}}
                <span class="text-small" tooltip="Catch weight pricing" ng-if="item.catchweight">LB</span>
              </div>
            </td>
            <td  class="hidden-mobile-visible-print text-left" >
            <div style="max-width:60px;" ng-if="item.itemstatistics.packageaverage || item.itemstatistics.caseaverage ">
            <a>
              <div ng-if="item.each && item.itemstatistics.packageaverage"
                  tooltip="View order history for this item."
                  ng-click="openItemUsageSummaryModal(item)">
                    {{item.itemstatistics.packageaverage == 1 ? item.itemstatistics.packageaverage + ' Pack' : item.itemstatistics.packageaverage + ' Packs'}}
              </div>
            </a>
            <a>
              <div ng-if="!item.each && item.itemstatistics.caseaverage"
                  tooltip="View order history for this item."
                  ng-click="openItemUsageSummaryModal(item)">
                    {{item.itemstatistics.caseaverage == 1 ? item.itemstatistics.caseaverage + ' Case' : item.itemstatistics.caseaverage + ' Cases'}}
              </div>
            </a>
          </div>
          <div ng-click="openItemUsageSummaryModal(item)" ng-if="(!item.itemstatistics.packageaverage && item.each) || (!item.itemstatistics.caseaverage && !item.each)">
            None
          </div>
           </td>
            <td class="hidden-mobile-visible-print">
              <div ng-if="item.canOrder">
                {{item.extPrice | currency}}
              </div>
            </td>
            <td class="large-icon icon-col">
              <a class="visible-xs visible-sm"><span class="hidden-print text-light icon-ellipsis" ng-click="item.showDetails = !item.showDetails;"></span></a>
            </td>
          </tr>
          <tr ng-if="item.showDetails" ng-class="{ odd : $odd, even: $even }" class="mobile-details-row hidden-md hidden-lg">
            <td colspan="7">
              <table>
                <colgroup>
                  <col width="25%" />
                  <col width="75%" />
                </colgroup>
                <tr>
                  <td>Category</td>
                  <td>{{::item.class}}</td>
                </tr>
                <tr>
                  <td>Notes</td>
                  <td class="notes-col">{{::item.notes}}</td>
                </tr>
                <tr>
                  <td>Label</td>
                  <td class = "label-col">{{::item.label}}</td>
                </tr>
                <tr>
                  <td>Pack/Size</td>
                  <td>{{::item.packsize}}</td>
                </tr>
                <tr>
                  <td>Brand</td>
                  <td>{{::item.brand}}</td>
                </tr>
                <tr ng-if="selectedList.is_contract_list">
                  <td>Contract Category</td>
                  <td>{{::item.category}}</td>
                </tr>
                <tr>
                  <td item-icons></td>
                </tr>
                <tr ng-show="useParlevel">
                  <td>PAR Level</td>
                  <td>{{::item.parlevel}}</td>
                </tr>
                <tr ng-show="useParlevel && item.canOrder && item.isvalid">
                  <td>On Hand Amount</td>
                  <td class="input-col">
                    <ng-form name="parlevelForm_mobile">
                      <input
                        type="text"
                        class="input-number text-right mousetrap"
                        numeric-validation
                        ng-model="item.onhand"
                        ng-change="onItemOnHandAmountChanged(item)">
                    </ng-form>
                  </td>
                </tr>
                <tr ng-show="item.hasPackagePrice && item.isvalid">
                  <td>Each</td>
                  <td>
                    <ng-form name="eachForm_mobile">
                      <input type="checkbox" ng-model="item.each" ng-checked = "!item.hasCasePrice || item.each" class="mousetrap" ng-disabled="!item.hasCasePrice" id="each" name="each" />
                    </ng-form>
                  </td>
                </tr>
                <tr ng-show="item.canOrder">
                  <td>Price</td>
                  <td>
                    {{item.each ? item.packageprice : item.caseprice | currency}}
                    <span class="text-small" tooltip="Catch weight pricing" ng-if="item.catchweight">LB</span>
                  </td>
                </tr>
                <tr ng-show="item.canOrder">
                  <td>Average Weekly </br> Usage</td>
                  <td  ng-click="openItemUsageSummaryModal(item)">
                    <div ng-if="(item.itemstatistics.packageaverage !== 0 || item.itemstatistics.caseaverage !== 0)">
                      <a><div ng-show="item.each && item.itemstatistics.packageaverage" tooltip="View order history for this item." class="pull-left" >{{item.itemstatistics.packageaverage}} Packs</div></a>
                      <a><div ng-show="!item.each && item.itemstatistics.caseaverage" tooltip="View order history for this item." class="pull-left">{{item.itemstatistics.caseaverage}} Cases</div></a>
                  </div>
                  <div ng-show="(!item.itemstatistics.packageaverage && item.each) || (!item.itemstatistics.caseaverage && !item.each)">None</div>
                </td>
                </tr>
                <tr ng-show="item.canOrder">
                  <td>Ext Price</td>
                  <td>{{item.extPrice | currency}}</td>
                </tr>
              </table>
            </td>
          </tr>
        </tbody>
        <tfoot ng-show="recommendedList.active && recommendedItems.length == 0">
            <tr>
              <td colspan="17">
                There are no recommended items to display.
              </td>
            </tr>
          </tfoot>
      </table>
    </tab>
</tabset>
</div>

  <div ng-show="selectedList.itemCount > pagingPageSize && showingPagination == 'true'">
   <pagination
    total-items="selectedList.itemCount"
    ng-model="currentPage"
    items-per-page="pagingPageSize"
    max-size="10"
    boundary-links="true"
    rotate="false"
    ng-change="blockUIAndChangePage(this)"
    class="pagination">
   </pagination>
  </div>
  
  </form>
</div>
